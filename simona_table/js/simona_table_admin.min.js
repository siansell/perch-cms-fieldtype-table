"use strict";var allTablesOnPage=[],tablePrefix="simona_hot_",setCulture=function(e){var t=$("#"+e+"_culture").val();numbro.culture(t)},initTables=function(){$("div[id^="+tablePrefix+"]").each(function(){var n=this.id.replace(tablePrefix,"");if(!$.grep(allTablesOnPage,function(e){return e.id===n}).length){var i=$("#"+n+"_data"),a=$("#"+n+"_headers"),e=$("#"+n+"_types"),t=$("#"+n+"_options");setCulture(n);for(var r=JSON.parse(i.val()),s=JSON.parse(a.val()),o=JSON.parse(e.val()),l=[],u=0;u<o.length;u++){var d={};d.type=o[u],l.push(d)}var c=JSON.parse(t.val());for(u=0;u<l.length;u++){var h=c[u].split(";");switch(l[u].type){case"numeric":c[u]&&(l[u].numericFormat={pattern:c[u]});break;case"date":c[u]&&(l[u].dateFormat=c[u],l[u].correctFormat=!0);break;case"checkbox":l[u].checkedTemplate=h[0],l[u].uncheckedTemplate=h[1];break;case"dropdown":l[u].source=h}}this.setData=function(e){setCulture(n);for(var t=e.getData(),a=0;a<t.length;a++)for(var r=0;r<t[a].length;r++)switch(o[r]){case"numeric":t[a][r]&&(t[a][r]=numbro(t[a][r]).format(c[r]))}var s=JSON.stringify(t);$(i).val(s)},this.setHeaders=function(e){var t=e.getColHeader();for(u=0;u<t.length;u++)t[u]||(t[u]="");t=JSON.stringify(t),$(a).val(t)};var p=this,v=document.getElementById(this.id),f=new Handsontable(v,{data:r,colHeaders:s,columns:l,contextMenu:{items:{row_above:{},row_below:{},remove_row:{}}},manualColumnResize:!0,manualRowResize:!0,rowHeaders:!1,afterChange:function(){p.setData(this)},afterGetColHeader:function(){p.setData(this),p.setHeaders(this)},afterCreateRow:function(){p.setData(this)},afterRemoveRow:function(){p.setData(this)},afterCreateCol:function(){p.setData(this)},afterRemoveCol:function(){p.setData(this)}});this.setHeaders(f),f.id=n,allTablesOnPage.push(f)}})};function getHotFromID(t){var e=$.grep(allTablesOnPage,function(e){return e.id===t.replace(tablePrefix,"")});return 0!==e.length&&e[0]}function editColHeaders(t,e){var a=getHotFromID(t);if(a.hasColHeaders()&&!1!==a){$(e).hide();var r=e.id.replace("edit","save");$("#"+r).show(),$('input[type="submit"]#btnsubmit').prop("disabled",!0),$('input[type="submit"]#add_another').prop("disabled",!0);var s=a.getColHeader();a.updateSettings({colHeaders:function(e){return'<input type="text" onchange="javascript:saveHeader(\''+t+"', "+e+', $(this).val());" value="'+s[e]+'" />'},afterOnCellMouseDown:function(e,t){-1===t.row&&this.getInstance().deselectCell()}})}}function saveColHeaders(e,t){var a=getHotFromID(e);if(a.hasColHeaders()&&!1!==a){$(t).hide();var r=t.id.replace("save","edit");$("#"+r).show();for(var s=[],n=a.getColHeader(),i=0;i<n.length;i++)s.push($(n[i]).attr("value"));a.updateSettings({colHeaders:s}),$('input[type="submit"]#btnsubmit').prop("disabled",!1),$('input[type="submit"]#add_another').prop("disabled",!1)}}function saveHeader(e,t,a){var r=getHotFromID(e);if(r.hasColHeaders()&&!1!==r){var s=r.getColHeader();s[t]='<input type="text" onchange="javascript:saveHeader(\''+e+"', "+t+', $(this).val());" value="'+a+'" />',r.updateSettings({colHeaders:s})}}$(window).on("Perch_Init_Editors",initTables),initTables();